<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ê·€ì—¼ë½€ì§ ê°•ì•„ì§€ í‚¤ìš°ê¸°</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap');
    body {
      margin: 0;
      font-family: 'Gowun Dodum', sans-serif;
      background-color: #fff8f0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      margin-top: 30px;
      font-size: 2.8rem;
      color: #ff914d;
    }
    .screen {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .active {
      display: flex !important;
    }
    .button {
      padding: 12px 24px;
      margin: 10px;
      font-size: 1.1rem;
      background: #ffcdcd;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: background 0.2s;
    }
    .button:hover {
      background: #ffa4a4;
    }
    input {
      padding: 10px;
      font-size: 1rem;
      border-radius: 10px;
      border: 1px solid #ccc;
      margin-top: 10px;
    }

    #game-wrapper {
      width: 95%;
      max-width: 820px;
      aspect-ratio: 4 / 3;
      position: relative;
      background: #fff;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      margin-top: 20px;
    }
    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    /* ğŸ¾ ìƒíƒœì°½ */
    .status-bar {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(255, 255, 255, 0.95);
      padding: 10px 15px;
      border-radius: 15px;
      font-size: 0.95rem;
      line-height: 1.4;
      border: 1px solid #ffdad5;
    }
    .event-timer {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255, 243, 234, 0.95);
      padding: 10px 15px;
      border-radius: 15px;
      font-size: 0.95rem;
      color: #cc5c00;
      border: 1px dashed #ffa65e;
    }

    /* ğŸ‰ ì¶•í•˜ ì´í™íŠ¸ */
    .celebrate {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2.2rem;
      background: #fff3cd;
      color: #d9480f;
      padding: 15px 25px;
      border: 2px solid #ffd6a5;
      border-radius: 20px;
      box-shadow: 0 5px 10px rgba(0,0,0,0.1);
      z-index: 999;
      display: none;
    }
  </style>
</head>
<body>
  <h1>ğŸ¶ ê·€ì—¼ë½€ì§ ê°•ì•„ì§€ í‚¤ìš°ê¸°</h1>

  <!-- ğŸ® ì‹œì‘ í™”ë©´ -->
  <div id="start-screen" class="screen active">
    <p>ê°•ì•„ì§€ ì´ë¦„ì„ ì§€ì–´ì£¼ì„¸ìš”:</p>
    <input type="text" id="puppy-name" placeholder="ì˜ˆ: ë­‰ì¹˜" />
    <p>ê°•ì•„ì§€ í’ˆì¢…ì„ ì„ íƒí•˜ì„¸ìš”:</p>
    <div>
      <button class="button" onclick="selectBreed('g')">ê³¨ë“  ë¦¬íŠ¸ë¦¬ë²„</button>
      <button class="button" onclick="selectBreed('b')">ë¹„ìˆ‘ í”„ë¦¬ì œ</button>
    </div>
  </div>

  <!-- ğŸ¾ ê²Œì„ í™”ë©´ -->
  <div id="game-screen" class="screen">
    <div id="game-wrapper">
      <canvas id="gameCanvas" width="800" height="600"></canvas>
      <div class="status-bar" id="statusBar"></div>
      <div class="event-timer" id="eventTimer">ë‹¤ìŒ ì´ë²¤íŠ¸ê¹Œì§€: 20ì´ˆ</div>
      <div class="celebrate" id="celebrate">ğŸ‰ ì„±ì¥í–ˆì–´ìš”!</div>
    </div>
    <audio id="bgm" loop>
      <source src="https://dessa95.github.io/puppy-game-drive/bgm.mp3" type="audio/mp3" />
    </audio>
  </div>
<script>
  let gameState = {
    name: '',
    breed: '',
    age: 0,
    hunger: 50,
    intimacy: 50,
    stage: 1, // 1: ì‹ ìƒì•„, 2: ì²­ì†Œë…„, 3: ì„±ë…„, 4: ë…¸ë ¹
    timer: 20,
    imageKey: '',
  };

  const images = {};
  const breedImages = {
    g: ['g1', 'g2', 'g3', 'g4'],
    b: ['b1', 'b2', 'b3', 'b4']
  };

  function selectBreed(breed) {
    const nameInput = document.getElementById('puppy-name');
    const name = nameInput.value.trim();
    if (name === '') {
      alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!");
      return;
    }

    gameState.name = name;
    gameState.breed = breed;
    gameState.imageKey = breedImages[breed][0];

    preloadImages(() => {
      document.getElementById('start-screen').classList.remove('active');
      document.getElementById('game-screen').classList.add('active');
      document.getElementById('bgm').play();
      initGame();
    });
  }

  function preloadImages(callback) {
    let loaded = 0;
    const keys = [...breedImages.g, ...breedImages.b];
    keys.forEach(key => {
      const img = new Image();
      img.src = `https://dessa95.github.io/puppy-game-drive/${key}.png`;
      img.onload = () => {
        images[key] = img;
        loaded++;
        if (loaded === keys.length) {
          callback();
        }
      };
    });
  }

  function drawPuppy(ctx) {
    const key = gameState.imageKey;
    const img = images[key];
    if (!img) return;
    ctx.clearRect(0, 0, 800, 600);
    ctx.drawImage(img, 250, 150, 300, 300);
  }

  function updateStatusBar() {
    const bar = document.getElementById('statusBar');
    bar.innerHTML = `
      ì´ë¦„: ${gameState.name}<br>
      ë‚˜ì´: ${gameState.age}<br>
      ë°°ê³ í””: ${gameState.hunger}<br>
      ì¹œë°€ë„: ${gameState.intimacy}
    `;
  }

  function updateTimerDisplay() {
    const t = document.getElementById('eventTimer');
    t.innerText = `ë‹¤ìŒ ì´ë²¤íŠ¸ê¹Œì§€: ${gameState.timer}ì´ˆ`;
  }
</script>
<script>
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");

  const celebrateEl = document.getElementById("celebrate");

  const randomEvents = [
    { text: "ì‚°ì±… ê°ˆ ì‹œê°„ì´ì—ìš”!", choices: [{ text: "ì‹ ë‚˜ê²Œ ë‹¬ë¦°ë‹¤", stat: 'intimacy', value: 10 }, { text: "ì²œì²œíˆ ê±·ëŠ”ë‹¤", stat: 'intimacy', value: 5 }] },
    { text: "ëª©ìš•í•  ì‹œê°„! ë¬¼ì´ ì‹«ì–´ìš”!", choices: [{ text: "ë¶€ë“œëŸ½ê²Œ ì”»ê¸´ë‹¤", stat: 'intimacy', value: 5 }, { text: "ê°„ì‹ì„ ì£¼ë©° ë‹¬ëœë‹¤", stat: 'hunger', value: 10, stat2: 'intimacy', value2: 2 }] },
    { text: "ë°°ê°€ ê³ íŒŒìš”! ë°¥ ì£¼ì„¸ìš”!", choices: [{ text: "ì‚¬ë£Œë¥¼ ì¤€ë‹¤", stat: 'hunger', value: 20 }, { text: "íŠ¹ì‹ì„ ì¤€ë‹¤", stat: 'hunger', value: 30, stat2: 'intimacy', value2: 5 }] },
    { text: "ë†€ì•„ì£¼ì„¸ìš”!", choices: [{ text: "ê³µë†€ì´ë¥¼ í•œë‹¤", stat: 'intimacy', value: 15 }, { text: "í„°ê·¸ ë†€ì´ë¥¼ í•œë‹¤", stat: 'intimacy', value: 12 }] },
    { text: "ë³‘ì›ì€ ë¬´ì„œì›Œìš”!", choices: [{ text: "ìš©ê°í•˜ê²Œ ì£¼ì‚¬ ë§ê¸°", stat: 'intimacy', value: -5 }, { text: "ì¹­ì°¬í•˜ë©° ë‹¬ë˜ì£¼ê¸°", stat: 'intimacy', value: 5 }] },
    { text: "ìƒˆë¡œìš´ ê°œì¸ê¸°ë¥¼ ë°°ìš¸ë˜ìš”!", choices: [{ text: "'ì†!' ê°€ë¥´ì¹˜ê¸°", stat: 'intimacy', value: 10 }, { text: "'ì½”!' ê°€ë¥´ì¹˜ê¸°", stat: 'intimacy', value: 10 }] },
    { text: "ì§‘ì´ ì—‰ë§ì´ ëì–´ìš”...", choices: [{ text: "ê°™ì´ ì¹˜ìš°ì", stat: 'intimacy', value: 7 }, { text: "ì¡°ìš©íˆ í˜¼ë‚¸ë‹¤", stat: 'intimacy', value: -10 }] },
    { text: "ê³µì›ì—ì„œ ì¹œêµ¬ë¥¼ ë§Œë‚¬ì–´ìš”!", choices: [{ text: "ê°™ì´ ë†€ê²Œ í•œë‹¤", stat: 'intimacy', value: 10 }, { text: "ì¡°ì‹¬í•˜ë¼ê³  ë¶€ë¥¸ë‹¤", stat: 'intimacy', value: -2 }] },
    { text: "ê°„ì‹ì„ ì°¾ì•˜ì–´ìš”!", choices: [{ text: "ë§›ìˆê²Œ ë¨¹ê²Œ í•œë‹¤", stat: 'hunger', value: 15, stat2: 'intimacy', value2: 5 }, { text: "ì´ë”° ë°¥ ë¨¹ìê³  í•œë‹¤", stat: 'hunger', value: -5 }] },
    { text: "ë¹„ ì˜¤ëŠ” ë‚  ì°½ë°–ì„ ë°”ë¼ë´ìš”", choices: [{ text: "ë”°ëœ»í•œ ë‹´ìš”ë¥¼ ë®ì–´ì¤€ë‹¤", stat: 'intimacy', value: 10 }, { text: "ê°„ì‹ì„ ì¤€ë‹¤", stat: 'hunger', value: 10 }] },
    { text: "ê°•ì•„ì§€ê°€ ì´ìƒí•œ ì†Œë¦¬ë¥¼ ë“¤ì–´ìš”", choices: [{ text: "ì§„ì •ì‹œí‚¨ë‹¤", stat: 'intimacy', value: 5 }, { text: "ê°™ì´ ì£¼ë³€ì„ ì‚´í•€ë‹¤", stat: 'intimacy', value: 7 }] },
    { text: "í˜¼ì ìˆì„ ì‹œê°„ì´ í•„ìš”í•´ ë³´ì—¬ìš”", choices: [{ text: "ì¡°ìš©íˆ í•´ì¤€ë‹¤", stat: 'intimacy', value: 2 }, { text: "ë†€ì•„ì£¼ë ¤ê³  í•œë‹¤", stat: 'intimacy', value: -2 }] },
  ];

  let currentEvent = null;
  let choiceButtons = [];

  function triggerEvent() {
    currentEvent = randomEvents[Math.floor(Math.random() * randomEvents.length)];
    drawEvent(currentEvent);
  }

  function drawEvent(event) {
    drawPuppy(ctx);
    ctx.fillStyle = "#000";
    ctx.font = "22px Gowun Dodum";
    ctx.fillText(event.text, 30, 520);

    clearChoices();
    event.choices.forEach((c, i) => {
      const btn = document.createElement('button');
      btn.className = 'button';
      btn.innerText = c.text;
      btn.style.position = 'absolute';
      btn.style.bottom = '20px';
      btn.style.left = `${40 + i * 220}px`;
      btn.onclick = () => {
        applyChoice(c);
        clearChoices();
      };
      choiceButtons.push(btn);
      document.getElementById('game-wrapper').appendChild(btn);
    });
  }

  function clearChoices() {
    choiceButtons.forEach(btn => btn.remove());
    choiceButtons = [];
  }

  function applyChoice(choice) {
    gameState[choice.stat] += choice.value;
    if (choice.stat2) gameState[choice.stat2] += choice.value2 || 0;
    gameState.hunger = Math.max(0, Math.min(100, gameState.hunger));
    gameState.intimacy = Math.max(0, Math.min(100, gameState.intimacy));
    updateStatusBar();
  }

  function checkGrowth() {
    if (gameState.age === 5 && gameState.stage === 1) {
      gameState.stage = 2;
      showGrowth();
    } else if (gameState.age === 10 && gameState.stage === 2) {
      gameState.stage = 3;
      showGrowth();
    } else if (gameState.age === 15 && gameState.stage === 3) {
      gameState.stage = 4;
      showGrowth();
    }
  }

  function showGrowth() {
    gameState.imageKey = breedImages[gameState.breed][gameState.stage - 1];
    celebrateEl.style.display = "block";
    setTimeout(() => celebrateEl.style.display = "none", 3000);
  }
</script>
<script>
  function initGame() {
    updateStatusBar();
    updateTimerDisplay();
    drawPuppy(ctx);

    setInterval(() => {
      gameState.timer--;
      updateTimerDisplay();

      if (gameState.timer <= 0) {
        gameState.timer = 20;
        triggerEvent();
        gameState.age++;
        checkGrowth();
      }
    }, 1000);
  }
</script>

</body>
</html>
