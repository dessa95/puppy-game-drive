<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>강아지 키우기</title>
  <style>
    @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
    body {
      margin: 0;
      font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
      background-color: #fefae0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    h1 {
      margin: 20px;
      font-size: 2.5rem;
      color: #d4a373;
    }
    #game-wrapper {
      width: 95%;
      max-width: 800px;
      aspect-ratio: 4 / 3;
      position: relative;
      background: #ffffff;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
      border: 10px solid #ffffff;
    }
    canvas {
      width: 100%;
      height: 100%;
      display: block;
      cursor: pointer;
    }
    audio {
      display: none;
    }
  </style>
</head>
<body>
  <h1>나만의 강아지 키우기 🐶</h1>
  <div id="game-wrapper">
    <canvas id="gameCanvas" width="800" height="600"></canvas>
  </div>
  <audio id="bgm" autoplay loop>
    <source src="https://dessa95.github.io/puppy-game-drive/bgm.mp3" type="audio/mp3" />
  </audio>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    let dog = null;
    let stage = 0;
    let age = 0;
    let frame = 0;
    let breed = null;
    const images = {};
    const stages = ['신생아기', '청소년기', '성년기', '노령기'];

    const breeds = {
      '골든 리트리버': ['g1', 'g2', 'g3', 'g4'],
      '비숑 프리제': ['b1', 'b2', 'b3', 'b4']
    };

    function preloadImages(callback) {
      let loaded = 0, total = 8;
      const keys = ['g1','g2','g3','g4','b1','b2','b3','b4'];
      keys.forEach(key => {
        const img = new Image();
        img.src = `https://dessa95.github.io/puppy-game-drive/${key}.png`;
        img.onload = () => {
          images[key] = img;
          loaded++;
          if (loaded === total) callback();
        };
      });
    }

    function drawScreen() {
      ctx.fillStyle = '#fefae0';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      if (!breed) {
        ctx.fillStyle = '#2a9d8f';
        ctx.font = 'bold 36px Pretendard';
        ctx.textAlign = 'center';
        ctx.fillText('강아지를 선택하세요', canvas.width/2, 100);

        const options = Object.keys(breeds);
        options.forEach((b, i) => {
          ctx.fillStyle = '#ffcb77';
          ctx.fillRect(250, 200 + i*100, 300, 60);
          ctx.strokeStyle = '#d62828';
          ctx.strokeRect(250, 200 + i*100, 300, 60);
          ctx.fillStyle = '#000';
          ctx.fillText(b, canvas.width/2, 240 + i*100);
        });
      } else if (!dog) {
        ctx.fillStyle = '#2a9d8f';
        ctx.font = 'bold 28px Pretendard';
        ctx.fillText('이름을 입력하세요 (Enter)', canvas.width/2, 300);
        ctx.fillStyle = '#000';
        ctx.fillText(dogName + '|', canvas.width/2, 360);
      } else {
        // draw background
        ctx.fillStyle = '#e9c46a';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = '#f4a261';
        ctx.fillRect(0, 450, canvas.width, 150);

        // draw dog
        const imgKey = breeds[breed][stage];
        const img = images[imgKey];
        ctx.drawImage(img, canvas.width/2 - 100, canvas.height/2 - 150, 200, 200);

        // info
        ctx.fillStyle = '#fff';
        ctx.fillRect(20, 20, 300, 100);
        ctx.strokeStyle = '#000';
        ctx.strokeRect(20, 20, 300, 100);
        ctx.fillStyle = '#000';
        ctx.font = '20px Pretendard';
        ctx.fillText(`이름: ${dogName}`, 30, 50);
        ctx.fillText(`나이: ${age}살 (${stages[stage]})`, 30, 80);
      }
    }

    let dogName = '';

    function gameLoop() {
      frame++;
      if (dog) {
        if (frame % 600 === 0) {
          age++;
          if (age === 2) stage = 1;
          else if (age === 5) stage = 2;
          else if (age === 10) stage = 3;
        }
      }
      drawScreen();
      requestAnimationFrame(gameLoop);
    }

    canvas.addEventListener('click', (e) => {
      if (!breed) {
        const y = e.offsetY;
        if (y > 200 && y < 260) breed = '골든 리트리버';
        else if (y > 300 && y < 360) breed = '비숑 프리제';
      }
    });

    window.addEventListener('keydown', (e) => {
      if (breed && !dog) {
        if (e.key === 'Enter' && dogName.length > 0) {
          dog = { name: dogName, breed };
        } else if (e.key === 'Backspace') {
          dogName = dogName.slice(0, -1);
        } else if (e.key.length === 1 && dogName.length < 10) {
          dogName += e.key;
        }
      }
    });

    preloadImages(() => {
      gameLoop();
    });
  </script>
</body>
</html>
