<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ê·€ì—¼ë½€ì§ ê°•ì•„ì§€ í‚¤ìš°ê¸°</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Gowun+Dodum&display=swap');
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Gowun Dodum', sans-serif;
      background-color: #fff8f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    h1 {
      margin-top: 30px;
      font-size: 2.8rem;
      color: #ff914d;
    }
    .screen {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .active {
      display: flex !important;
    }
    .button {
      padding: 12px 24px;
      margin: 10px;
      font-size: 1.1rem;
      background: #ffcdcd;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: background 0.2s;
    }
    .button:hover {
      background: #ffa4a4;
    }
    input {
      padding: 10px;
      font-size: 1rem;
      border-radius: 10px;
      border: 1px solid #ccc;
      margin-top: 10px;
    }
    #game-wrapper {
      width: 100%;
      max-width: 900px;
      height: 600px;
      position: relative;
      background: #ffffff;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
      margin-top: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding-top: 80px;
    }
    .status-bar {
      position: absolute;
      top: 10px;
      left: 10px;
      background: rgba(255, 255, 255, 0.95);
      padding: 10px 15px;
      border-radius: 15px;
      font-size: 0.95rem;
      line-height: 1.4;
      border: 1px solid #ffdad5;
    }
    .event-timer {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(255, 243, 234, 0.95);
      padding: 10px 15px;
      border-radius: 15px;
      font-size: 0.95rem;
      color: #cc5c00;
      border: 1px dashed #ffa65e;
    }
    .celebrate {
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2.2rem;
      background: #fff3cd;
      color: #d9480f;
      padding: 15px 25px;
      border: 2px solid #ffd6a5;
      border-radius: 20px;
      box-shadow: 0 5px 10px rgba(0,0,0,0.1);
      z-index: 999;
      display: none;
    }
    .puppy-image {
      width: 260px;
      height: auto;
      margin: 10px;
      transition: transform 0.3s ease;
    }
    .shake {
      animation: shake 0.6s ease;
    }
    .grow {
      animation: grow 0.6s ease;
    }
    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      50% { transform: translateX(10px); }
      75% { transform: translateX(-10px); }
      100% { transform: translateX(0); }
    }
    @keyframes grow {
      0% { transf
    .interaction-toggle {
      margin-top: 15px;
    }
    .interaction-panel {
      display: none;
      flex-direction: column;
      align-items: center;
      margin-top: 10px;
    }
    .interaction-panel .button {
      background: #d2f4dc;
      margin: 5px;
    }
    #event-box {
      margin-top: 10px;
      width: 90%;
      background: #fff7e6;
      padding: 15px;
      border-radius: 15px;
      border: 1px solid #ffe0b3;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #event-text {
      font-size: 1.1rem;
      margin-bottom: 10px;
      text-align: center;
      color: #cc5c00;
    }
    .event-options {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .album-screen {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 30px;
      background: #fffdf4;
      width: 100%;
      height: 100vh;
    }
    .album-screen h2 {
      font-size: 2rem;
      color: #e56700;
      margin-bottom: 20px;
    }
    .album-photos {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }
    .album-photos img {
      width: 180px;
      border-radius: 15px;
      border: 2px solid #ffc68d;
    }
    .restart-button {
      margin-top: 30px;
      background: #ffe2c6;
    }
  </style>
</head>
<body>
  <h1>ğŸ¶ ê·€ì—¼ë½€ì§ ê°•ì•„ì§€ í‚¤ìš°ê¸°</h1>

  <!-- 1. ì²« í™”ë©´: ê²Œì„ ì‹œì‘ -->
  <div id="launch-screen" class="screen active">
    <button class="button" onclick="goToBreedSelect()">ê²Œì„ ì‹œì‘</button>
  </div>

  <!-- 2. í’ˆì¢… ì„ íƒ -->
  <div id="breed-screen" class="screen">
    <p>ê°•ì•„ì§€ í’ˆì¢…ì„ ì„ íƒí•˜ì„¸ìš”:</p>
    <div>
      <button class="button" onclick="selectBreed('g')">ê³¨ë“  ë¦¬íŠ¸ë¦¬ë²„</button>
      <button class="button" onclick="selectBreed('b')">ë¹„ìˆ‘ í”„ë¦¬ì œ</button>
    </div>
  </div>

  <!-- 3. ì´ë¦„ ì…ë ¥ -->
  <div id="name-screen" class="screen">
    <p>ê°•ì•„ì§€ ì´ë¦„ì„ ì§€ì–´ì£¼ì„¸ìš”:</p>
    <input type="text" id="puppy-name" placeholder="ì˜ˆ: ë­‰ì¹˜" />
    <button class="button" onclick="startGame()">ì´ë¦„ í™•ì •í•˜ê³  ê²Œì„ ì‹œì‘</button>
  </div>

  <!-- 4. ë³¸ ê²Œì„ í™”ë©´ -->
  <div id="game-screen" class="screen">
    <div id="game-wrapper">
      <img id="puppy-img" class="puppy-image" src="" alt="puppy" />
      <div class="status-bar" id="statusBar"></div>
      <div class="event-timer" id="eventTimer">ë‹¤ìŒ ì´ë²¤íŠ¸ê¹Œì§€: 20ì´ˆ</div>
      <div class="celebrate" id="celebrate">ğŸ‰ ì„±ì¥í–ˆì–´ìš”! <button class="button" onclick="acknowledgeGrowth()">ì¶•í•˜í•´</button></div>
    </div>
    <div id="event-box">
      <div id="event-text">ì´ë²¤íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤.</div>
      <div class="event-options" id="event-options"></div>
    </div>
    <div class="interaction-toggle">
      <button class="button" onclick="toggleInteractionPanel()">ì§ì ‘ ìƒí˜¸ì‘ìš© ğŸ”</button>
    </div>
    <div class="interaction-panel" id="interactionPanel">
      <button class="button" onclick="directInteraction('ì“°ë‹¤ë“¬ê¸°')">ì“°ë‹¤ë“¬ê¸°</button>
      <button class="button" onclick="directInteraction('ê·€ ëƒ„ìƒˆ ë§¡ê¸°')">ê·€ ëƒ„ìƒˆ ë§¡ê¸°</button>
      <button class="button" onclick="directInteraction('ë°œ ëƒ„ìƒˆ ë§¡ê¸°')">ë°œ ëƒ„ìƒˆ ë§¡ê¸°</button>
      <button class="button" onclick="directInteraction('ê»´ì•ˆê¸°')">ê»´ì•ˆê¸°</button>
    </div>
    <audio id="bgm" loop>
      <source src="https://dessa95.github.io/puppy-game-drive/bgm.mp3" type="audio/mp3" />
    </audio>
  </div>

  <!-- 5. ì¶”ì–µ ì•¨ë²” í™”ë©´ -->
  <div id="album-screen" class="album-screen">
    <h2 id="album-title">ğŸ¾ ì¶”ì–µ ì•¨ë²”</h2>
    <div class="album-photos" id="albumPhotos"></div>
    <button class="button restart-button" onclick="restartGame()">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
  </div>
  <script>
    // ìƒíƒœ ì €ì¥ ë³€ìˆ˜ë“¤
    let breed = '';
    let puppyName = '';
    let age = 0;
    let mood = 5; // ê¸°ë¶„ ì ìˆ˜ (0~10)
    let ageTimer, eventTimer, albumTimer;
    let eventCountdown = 20;
    let isEventActive = false;
    let isGrowing = false;
    let growthLog = [];

    const breedMap = {
      g: ['g1', 'g2', 'g3', 'g4'],
      b: ['b1', 'b2', 'b3', 'b4']
    };

    function goToBreedSelect() {
      switchScreen('launch-screen', 'breed-screen');
      const bgm = document.getElementById("bgm");
      bgm.play();
    }

    function selectBreed(code) {
      breed = code;
      switchScreen('breed-screen', 'name-screen');
    }

    function startGame() {
      const input = document.getElementById('puppy-name');
      if (!input.value.trim()) {
        alert('ê°•ì•„ì§€ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
        return;
      }
      puppyName = input.value.trim();
      switchScreen('name-screen', 'game-screen');
      initializeGame();
    }

    function switchScreen(currentId, nextId) {
      document.getElementById(currentId).classList.remove('active');
      document.getElementById(nextId).classList.add('active');
    }

    function initializeGame() {
      updatePuppyImage();
      updateStatus();
      updateTimerDisplay();
      document.getElementById("event-text").innerText = '';
      document.getElementById("event-options").innerHTML = '';

      ageTimer = setInterval(() => {
        if (!isEventActive && !isGrowing) {
          age++;
          checkGrowth();
          updateStatus();
        }
      }, 20000);

      eventTimer = setInterval(() => {
        if (!isEventActive && !isGrowing) {
          eventCountdown -= 1;
          updateTimerDisplay();
          if (eventCountdown <= 0) {
            triggerRandomEvent();
            eventCountdown = 20;
          }
        }
      }, 1000);

      albumTimer = setInterval(() => {
        if (age >= 10 && !isEventActive && !isGrowing) {
          const overTime = age * 20 - 200;
          if (overTime >= 60) {
            showAlbum();
            clearInterval(ageTimer);
            clearInterval(eventTimer);
            clearInterval(albumTimer);
          }
        }
      }, 1000);
    }

    function updatePuppyImage() {
      const stage = getGrowthStage();
      const img = document.getElementById("puppy-img");
      img.src = `https://dessa95.github.io/puppy-game-drive/${breedMap[breed][stage]}.png`;
    }

    function getGrowthStage() {
      if (age < 2) return 0;
      if (age < 6) return 1;
      if (age < 10) return 2;
      return 3;
    }

    function updateStatus() {
      document.getElementById("statusBar").innerHTML =
        `ì´ë¦„: ${puppyName}<br>ë‚˜ì´: ${age}ì„¸<br>ê¸°ë¶„: ${getMoodText()}`;
    }

    function updateTimerDisplay() {
      document.getElementById("eventTimer").innerText = `ë‹¤ìŒ ì´ë²¤íŠ¸ê¹Œì§€: ${eventCountdown}ì´ˆ`;
    }

    function getMoodText() {
      if (mood >= 8) return "ğŸ˜„ ì•„ì£¼ ì¢‹ì•„ìš”!";
      if (mood >= 5) return "ğŸ™‚ ê´œì°®ì•„ìš”";
      if (mood >= 3) return "ğŸ˜ ì‚´ì§ ì˜ˆë¯¼í•´ìš”";
      return "ğŸ˜¢ ìš°ìš¸í•´ìš”";
    }

    function triggerRandomEvent() {
      isEventActive = true;
      const eventText = document.getElementById("event-text");
      const eventOptions = document.getElementById("event-options");
      const events = [
        {
          text: "ì‚°ì±… ê°€ê³  ì‹¶ì–´í•´ìš”!",
          options: [
            { label: "ê°™ì´ ì‚°ì±… ê°€ê¸°", effect: 2 },
            { label: "ë¬´ì‹œí•˜ê¸°", effect: -2 }
          ]
        },
        {
          text: "ë°°ê³ íŒŒ ë³´ì—¬ìš”.",
          options: [
            { label: "ê°„ì‹ ì£¼ê¸°", effect: 1 },
            { label: "ì•ˆ ì¤˜ë„ ë¼", effect: -1 }
          ]
        },
        {
          text: "ë†€ì•„ë‹¬ë¼ê³  ì¡¸ë¼ìš”.",
          options: [
            { label: "ê³µ ë˜ì§€ê¸°", effect: 2 },
            { label: "ê·€ì°®ì•„", effect: -2 }
          ]
        },
        {
          text: "ë‚¯ì„  ì‚¬ëŒì´ ì™”ì–´ìš”!",
          options: [
            { label: "ì¡°ìš©íˆ ì‹œí‚¤ê¸°", effect: 0 },
            { label: "ê°™ì´ ì§–ê¸°", effect: 1 }
          ]
        }
      ];

      const event = events[Math.floor(Math.random() * events.length)];
      eventText.innerText = event.text;
      eventOptions.innerHTML = '';
      event.options.forEach(opt => {
        const btn = document.createElement("button");
        btn.className = "button";
        btn.innerText = opt.label;
        btn.onclick = () => handleEventChoice(opt.effect);
        eventOptions.appendChild(btn);
      });
    }
    function handleEventChoice(effect) {
      mood += effect;
      if (mood > 10) mood = 10;
      if (mood < 0) mood = 0;

      const puppy = document.getElementById("puppy-img");
      if (effect > 0) {
        puppy.classList.add("happy-wiggle");
        setTimeout(() => puppy.classList.remove("happy-wiggle"), 1000);
      }

      document.getElementById("event-text").innerText = `ğŸ‘‰ ${effect > 0 ? 'ê¸°ë¶„ì´ ì¢‹ì•„ì¡Œì–´ìš”!' : 'ê¸°ë¶„ì´ ë‚˜ë¹ ì¡Œì–´ìš”...'}`;
      document.getElementById("event-options").innerHTML = '';

      updateStatus();
      setTimeout(() => {
        document.getElementById("event-text").innerText = '';
        isEventActive = false;
      }, 2000);
    }

    function directInteraction(type) {
      const effects = {
        'ì“°ë‹¤ë“¬ê¸°': 1,
        'ê·€ ëƒ„ìƒˆ ë§¡ê¸°': 0,
        'ë°œ ëƒ„ìƒˆ ë§¡ê¸°': -1,
        'ê»´ì•ˆê¸°': 2
      };
      handleEventChoice(effects[type]);
    }

    function checkGrowth() {
      const stage = getGrowthStage();
      if (!growthLog.includes(stage)) {
        growthLog.push(stage);
        showGrowthCelebrate(stage);
      }
    }

    function showGrowthCelebrate(stage) {
      isGrowing = true;
      updatePuppyImage();
      updateStatus();
      const text = ["ğŸ¼ ì‹ ìƒì•„ê¸°!", "ğŸ¾ ì²­ì†Œë…„ê¸°!", "ğŸ¦´ ì„±ê²¬ê¸°!", "ğŸ§“ ë…¸ë ¹ê¸°!"][stage];
      const celebrate = document.getElementById("celebrate");
      celebrate.innerText = `${text} ì„±ì¥í–ˆì–´ìš”!`;
      celebrate.style.display = "block";

      const puppy = document.getElementById("puppy-img");
      puppy.classList.add("grow-bounce");

      const nextBtn = document.createElement("button");
      nextBtn.className = "button";
      nextBtn.innerText = "ğŸ‰ ì¶•í•˜í•´";
      nextBtn.onclick = () => {
        celebrate.style.display = "none";
        nextBtn.remove();
        puppy.classList.remove("grow-bounce");
        isGrowing = false;
      };
      celebrate.appendChild(nextBtn);
    }

    function showAlbum() {
      const puppy = document.getElementById("puppy-img");
      const wrapper = document.getElementById("game-wrapper");
      const timer = document.getElementById("eventTimer");
      const status = document.getElementById("statusBar");
      const interactionToggle = document.querySelector(".interaction-toggle");
      const panel = document.getElementById("interactionPanel");
      const eventText = document.getElementById("event-text");
      const eventOptions = document.getElementById("event-options");

      wrapper.innerHTML = `
        <div style="text-align: center; padding: 20px;">
          <h2>ğŸ“¸ ì¶”ì–µ ì•¨ë²”</h2>
          <p>${puppyName}ì´ê°€ ì˜ˆì˜ê³  ë©‹ì§€ê²Œ ìëì–´ìš”!</p>
          <img src="${puppy.src}" style="width: 200px; border-radius: 15px; box-shadow: 0 0 10px rgba(0,0,0,0.2);" />
          <br /><br />
          <button class="button" onclick="location.reload()">ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
        </div>
      `;

      // ë°°ê²½ìŒ ì •ì§€
      document.getElementById("bgm").pause();

      // ì¸í„°ë²Œ ì •ì§€
      clearInterval(ageTimer);
      clearInterval(eventTimer);
      clearInterval(albumTimer);
    }

    // ê·€ì—¬ìš´ ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼ë¥¼ ìœ„í•œ ìŠ¤íƒ€ì¼ ì‚½ì…
    const style = document.createElement("style");
    style.innerHTML = `
      @keyframes wiggle {
        0% { transform: rotate(0deg); }
        25% { transform: rotate(5deg); }
        50% { transform: rotate(-5deg); }
        75% { transform: rotate(5deg); }
        100% { transform: rotate(0deg); }
      }
      .happy-wiggle {
        animation: wiggle 1s ease;
      }

      @keyframes grow {
        0% { transform: scale(1); }
        50% { transform: scale(1.2); }
        100% { transform: scale(1); }
      }
      .grow-bounce {
        animation: grow 1s ease;
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>
