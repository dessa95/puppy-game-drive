<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ê°•ì•„ì§€ í‚¤ìš°ê¸°</title>
  <style>
    @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
    body {
      margin: 0;
      font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
      background-color: #fefae0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
    }
    h1 {
      margin: 20px;
      font-size: 2.5rem;
      color: #d4a373;
    }
    #game-wrapper {
      width: 95%;
      max-width: 800px;
      aspect-ratio: 4 / 3;
      position: relative;
      background: #ffffff;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
      border: 10px solid #ffffff;
    }
    canvas {
      width: 100%;
      height: 100%;
      display: block;
      cursor: pointer;
    }
    audio {
      display: none;
    }
    .emotion-icon {
      position: absolute;
      bottom: 10px;
      right: 10px;
      font-size: 36px;
    }
  </style>
</head>
<body>
  <h1>ë‚˜ë§Œì˜ ê°•ì•„ì§€ í‚¤ìš°ê¸° ğŸ¶</h1>
  <div id="game-wrapper">
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div class="emotion-icon" id="emotion">ğŸ˜</div>
  </div>
  <audio id="bgm" autoplay loop>
    <source src="https://dessa95.github.io/puppy-game-drive/bgm.mp3" type="audio/mp3" />
  </audio>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const emotionEl = document.getElementById("emotion");

    let puppyType = "g"; // g = ê³¨ë“  ë¦¬íŠ¸ë¦¬ë²„, b = ë¹„ìˆ‘ í”„ë¦¬ì œ
    let puppyStage = 1;  // 1: ì‹ ìƒì•„, 2: ì²­ì†Œë…„, 3: ì„±ë…„, 4: ë…¸ë ¹ê¸°
    let seconds = 0;

    const images = {};
    const imageNames = ["g1", "g2", "g3", "g4", "b1", "b2", "b3", "b4"];

    let gameState = {
      hunger: 50,
      intimacy: 50,
      age: 0,
    };

    let currentEvent = null;
    let isEventActive = false;

    function preloadImages(callback) {
      let loaded = 0;
      imageNames.forEach(name => {
        const img = new Image();
        img.src = `https://dessa95.github.io/puppy-game-drive/${name}.png`;
        img.onload = () => {
          images[name] = img;
          loaded++;
          if (loaded === imageNames.length) callback();
        };
      });
    }

    function getImageKey() {
      return puppyType + puppyStage;
    }

    function drawPuppy() {
      const img = images[getImageKey()];
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (img) {
        ctx.drawImage(img, 200, 100, 400, 400);
      }
    }

    function updateEmotion() {
      const { hunger, intimacy } = gameState;
      if (hunger < 30 || intimacy < 30) {
        emotionEl.textContent = "ğŸ˜¢";
      } else if (hunger > 70 && intimacy > 70) {
        emotionEl.textContent = "ğŸ˜„";
      } else {
        emotionEl.textContent = "ğŸ˜";
      }
    }

    function applyChoice(choice) {
      gameState[choice.stat] += choice.value;
      if (choice.stat2) gameState[choice.stat2] += choice.value2 || 0;
      gameState.hunger = Math.max(0, Math.min(100, gameState.hunger));
      gameState.intimacy = Math.max(0, Math.min(100, gameState.intimacy));
      updateEmotion();
      currentEvent = null;
      isEventActive = false;
    }

    function drawEvent(event) {
      ctx.fillStyle = "rgba(0,0,0,0.7)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#fff";
      ctx.font = "24px Pretendard";
      ctx.fillText(event.text, 40, 100);
      event.choices.forEach((choice, i) => {
        ctx.fillText(`${i + 1}. ${choice.text}`, 60, 160 + i * 40);
      });
    }

    function triggerEvent() {
      const event = randomEvents[Math.floor(Math.random() * randomEvents.length)];
      currentEvent = event;
      isEventActive = true;
      drawEvent(event);
    }

    document.addEventListener("keydown", (e) => {
      if (!isEventActive || !currentEvent) return;
      const index = parseInt(e.key);
      if (index === 1 || index === 2) {
        applyChoice(currentEvent.choices[index - 1]);
      }
    });

    function gameLoop() {
      seconds++;
      if (seconds % 10 === 0) gameState.age += 1;

      if (gameState.age === 5) puppyStage = 2;
      else if (gameState.age === 10) puppyStage = 3;
      else if (gameState.age === 15) puppyStage = 4;

      if (!isEventActive && seconds % 20 === 0) {
        triggerEvent();
      }

      if (!isEventActive) drawPuppy();
    }
    const randomEvents = [
      { text: "ì‚°ì±… ê°ˆ ì‹œê°„ì´ì—ìš”!", choices: [{ text: "ì‹ ë‚˜ê²Œ ë‹¬ë¦°ë‹¤", stat: 'intimacy', value: 10 }, { text: "ì²œì²œíˆ ê±·ëŠ”ë‹¤", stat: 'intimacy', value: 5 }], anim: () => flashCanvas('#b4d4ff') },
      { text: "ëª©ìš•í•  ì‹œê°„! ë¬¼ì´ ì‹«ì–´ìš”!", choices: [{ text: "ë¶€ë“œëŸ½ê²Œ ì”»ê¸´ë‹¤", stat: 'intimacy', value: 5 }, { text: "ê°„ì‹ì„ ì£¼ë©° ë‹¬ëœë‹¤", stat: 'hunger', value: 10, stat2: 'intimacy', value2: 2 }], anim: () => flashCanvas('#d0f0fd') },
      { text: "ë°°ê°€ ê³ íŒŒìš”! ë°¥ ì£¼ì„¸ìš”!", choices: [{ text: "ì‚¬ë£Œë¥¼ ì¤€ë‹¤", stat: 'hunger', value: 20 }, { text: "íŠ¹ì‹ì„ ì¤€ë‹¤", stat: 'hunger', value: 30, stat2: 'intimacy', value2: 5 }], anim: () => flashCanvas('#fff1bd') },
      { text: "ë†€ì•„ì£¼ì„¸ìš”!", choices: [{ text: "ê³µë†€ì´ë¥¼ í•œë‹¤", stat: 'intimacy', value: 15 }, { text: "í„°ê·¸ ë†€ì´ë¥¼ í•œë‹¤", stat: 'intimacy', value: 12 }], anim: () => flashCanvas('#ffe2f1') },
      { text: "ìœ¼ì•™! ë³‘ì›ì€ ë¬´ì„œì›Œìš”!", choices: [{ text: "ìš©ê°í•˜ê²Œ ì£¼ì‚¬ ë§ê¸°", stat: 'intimacy', value: -5 }, { text: "ì¹­ì°¬í•˜ë©° ë‹¬ë˜ì£¼ê¸°", stat: 'intimacy', value: 5 }], anim: () => flashCanvas('#ffcccc') },
      { text: "ìƒˆë¡œìš´ ê°œì¸ê¸°ë¥¼ ë°°ìš¸ë˜ìš”!", choices: [{ text: "'ì†!' ê°€ë¥´ì¹˜ê¸°", stat: 'intimacy', value: 10 }, { text: "'ì½”!' ê°€ë¥´ì¹˜ê¸°", stat: 'intimacy', value: 10 }], anim: () => flashCanvas('#f0fff0') },
      { text: "ì‹¤ìˆ˜í–ˆì–´ìš”... ì§‘ì´ ì—‰ë§ì´ ëì–´ìš”.", choices: [{ text: "ê´œì°®ì•„, ê°™ì´ ì¹˜ìš°ì", stat: 'intimacy', value: 7 }, { text: "ì¡°ìš©íˆ í˜¼ë‚¸ë‹¤", stat: 'intimacy', value: -10 }], anim: () => flashCanvas('#eaeaea') },
      { text: "ê³µì›ì—ì„œ ìƒˆë¡œìš´ ì¹œêµ¬ë¥¼ ë§Œë‚¬ì–´ìš”!", choices: [{ text: "ê°™ì´ ë†€ê²Œ í•œë‹¤", stat: 'intimacy', value: 10 }, { text: "ì¡°ì‹¬í•˜ë¼ê³  ë¶€ë¥¸ë‹¤", stat: 'intimacy', value: -2 }], anim: () => flashCanvas('#ccffcc') },
      { text: "ìˆ¨ê²¨ë‘” ê°„ì‹ì„ ì°¾ì•˜ì–´ìš”! ë¨¹ì–´ë„ ë˜ë‚˜ìš”?", choices: [{ text: "ë‹¹ì—°í•˜ì§€! ë§›ìˆê²Œ ë¨¹ì–´", stat: 'hunger', value: 15, stat2: 'intimacy', value2: 5 }, { text: "ì•ˆë¼! ì´ë”° ë°¥ ë¨¹ì–´ì•¼ì§€", stat: 'hunger', value: -5 }], anim: () => flashCanvas('#ffe4b5') },
      { text: "ì²œë‘¥ ì†Œë¦¬ì— ë†€ëì–´ìš”!", choices: [{ text: "ê¼­ ì•ˆì•„ì¤€ë‹¤", stat: 'intimacy', value: 8 }, { text: "ì¡°ìš©í•œ ë°©ìœ¼ë¡œ ë°ë ¤ê°„ë‹¤", stat: 'intimacy', value: 5 }], anim: () => flashCanvas('#a0c4ff') },
      { text: "í›ˆë ¨ì†Œì—ì„œ ì´ˆëŒ€ì¥ì´ ì™”ì–´ìš”!", choices: [{ text: "ì°¸ì—¬í•´ì„œ í›ˆë ¨ ë°›ëŠ”ë‹¤", stat: 'intimacy', value: 12 }, { text: "ë„ˆë¬´ ì–´ë ¤ìš¸ ê²ƒ ê°™ì•„ íŒ¨ìŠ¤", stat: 'intimacy', value: -2 }], anim: () => flashCanvas('#d0e6a5') },
      { text: "ì•„ê¸° ê³ ì–‘ì´ë¥¼ ë°œê²¬í–ˆì–´ìš”.", choices: [{ text: "ì§‘ìœ¼ë¡œ ë°ë ¤ì˜¨ë‹¤", stat: 'intimacy', value: 10 }, { text: "ê·¸ëƒ¥ ì§€ë‚˜ì¹œë‹¤", stat: 'intimacy', value: -3 }], anim: () => flashCanvas('#ffc2e0') },
      { text: "ìƒì¼ì´ì—ìš”! íŠ¹ë³„í•œ í•˜ë£¨!", choices: [{ text: "íŒŒí‹°ë¥¼ ì—´ì–´ì¤€ë‹¤", stat: 'intimacy', value: 15 }, { text: "ê°„ì‹ì„ ì¤€ë‹¤", stat: 'hunger', value: 20, stat2: 'intimacy', value2: 10 }], anim: () => flashCanvas('#ffe6cc') },
      { text: "ì•„íŒŒ ë³´ì—¬ìš”...", choices: [{ text: "ë³‘ì›ì— ë°ë ¤ê°„ë‹¤", stat: 'intimacy', value: 5 }, { text: "ì‰¬ê²Œ í•œë‹¤", stat: 'hunger', value: -10 }], anim: () => flashCanvas('#f8d7da') },
      { text: "ì°½ë°–ì„ ë°”ë¼ë³´ë©° ë©í•˜ë‹ˆ ìˆì–´ìš”.", choices: [{ text: "ê°™ì´ ì•‰ëŠ”ë‹¤", stat: 'intimacy', value: 6 }, { text: "ì‚°ì±… ê°€ìê³  í•œë‹¤", stat: 'intimacy', value: 8 }], anim: () => flashCanvas('#dee2ff') }
    ];

    function flashCanvas(color) {
      ctx.fillStyle = color;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      setTimeout(drawPuppy, 400);
    }

    preloadImages(() => {
      drawPuppy();
      updateEmotion();
      setInterval(gameLoop, 1000);
    });
  </script>
</body>
</html>
